<!DOCTYPE html>
<head>

	<link rel="manifest" href="/manifest.json">
	<!--script src="prompting.js"></script>
	<script src="registering.js"></script-->

	<meta name="viewport" content="width=device-width, initial-scale=1">


	<title>Welcome to PWAtest</title>
</head>
<body>
	<h1>This is the homepage</h1>
	<button id="install-button">INSTALL</button>

	<script>

		let installPromptEvent;
		let btnInstall = document.querySelector('#install-button');

		window.addEventListener('beforeinstallprompt', (event) => {
		  // Prevent Chrome <= 67 from automatically showing the prompt
		  event.preventDefault();
		  // Stash the event so it can be triggered later.
		  installPromptEvent = event;
		  console.log("Install prompt was found");
		  // Update the install UI to notify the user app can be installed
		  btnInstall.disabled = false;
		});


		btnInstall.addEventListener('click', () => {
		  // Update the install UI to remove the install button
		  btnInstall.disabled = true;
		  // Show the modal add to home screen dialog
		  installPromptEvent.prompt();
		  // Wait for the user to respond to the prompt
		  installPromptEvent.userChoice.then((choice) => {
		    if (choice.outcome === 'accepted') {
		      console.log('User accepted the A2HS prompt');
		    } else {
		      console.log('User dismissed the A2HS prompt');
		    }
		    // Clear the saved prompt since it can't be used again
		    installPromptEvent = null;
		  });
		});

		if ('serviceWorker' in navigator) {
		  window.addEventListener('load', function() {
		    navigator.serviceWorker.register('http://localhost:8000/service_worker.js').then(function(registration) {
		      // Registration was successful
		      console.log('ServiceWorker registration successful with scope: ', registration.scope);
		    }, function(err) {
		      // registration failed :(
		      console.log('ServiceWorker registration failed: ', err);
		    });
		  });
		}
	</script>
</body>
</html>